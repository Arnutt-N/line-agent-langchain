"""
Phase 1.4: ‡πÄ‡∏û‡∏¥‡πà‡∏° Templates ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 20 ‡∏Ç‡πâ‡∏≠
"""
import os
import sys
import io
sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from app.database import SessionLocal
from app.models import MessageCategory, MessageTemplate
import json
from datetime import datetime

def check_current_templates():
    """‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Templates ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà"""
    db = SessionLocal()
    try:
        # ‡∏ô‡∏±‡∏ö templates ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        total = db.query(MessageTemplate).count()
        print(f"üìä Templates ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà: {total} templates")
        
        # ‡πÅ‡∏™‡∏î‡∏á templates ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° category
        categories = db.query(MessageCategory).all()
        print("\nüìÅ Templates ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î:")
        
        existing_templates = []
        for cat in categories:
            templates = db.query(MessageTemplate).filter(
                MessageTemplate.category_id == cat.id
            ).all()
            
            if templates:
                print(f"\n{cat.name} ({len(templates)} templates):")
                for t in templates:
                    print(f"  - {t.name}")
                    existing_templates.append(t.name)
        
        return total, existing_templates
    finally:
        db.close()

def add_new_hr_templates():
    """‡πÄ‡∏û‡∏¥‡πà‡∏° Templates ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö HR"""
    db = SessionLocal()
    try:
        # Get category IDs
        categories = {cat.name: cat.id for cat in db.query(MessageCategory).all()}
        
        # Templates ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° (10 ‡∏Ç‡πâ‡∏≠)
        new_templates = [
            # ‡∏Å‡∏≤‡∏£‡∏•‡∏≤ (‡πÄ‡∏û‡∏¥‡πà‡∏° 3 ‡∏Ç‡πâ‡∏≠)
            {
                "name": "‡∏•‡∏≤‡∏Å‡∏¥‡∏à‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß",
                "description": "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å‡∏¥‡∏à‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß",
                "message_type": "text",
                "category_id": categories.get("‡∏Å‡∏≤‡∏£‡∏•‡∏≤"),
                "content": json.dumps({
                    "type": "text",
                    "text": "üìã ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å‡∏¥‡∏à‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß:\n\n‚Ä¢ ‡∏•‡∏≤‡πÑ‡∏î‡πâ‡∏õ‡∏µ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 45 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£\n‚Ä¢ ‡∏õ‡∏µ‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏•‡∏≤‡∏Å‡∏¥‡∏à\n‚Ä¢ ‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏∑‡πà‡∏ô‡πÉ‡∏ö‡∏•‡∏≤‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ß‡∏±‡∏ô\n\nüìå ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ ‡∏û.‡∏®. 2555"
                }),
                "tags": ["‡∏•‡∏≤‡∏Å‡∏¥‡∏à", "‡∏•‡∏≤‡∏Å‡∏¥‡∏à‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß", "personal leave"]
            },
            {
                "name": "‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î‡∏ö‡∏∏‡∏ï‡∏£",
                "description": "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î‡∏ö‡∏∏‡∏ï‡∏£",
                "message_type": "flex",
                "category_id": categories.get("‡∏Å‡∏≤‡∏£‡∏•‡∏≤"),
                "content": json.dumps({
                    "type": "flex",
                    "altText": "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î‡∏ö‡∏∏‡∏ï‡∏£",
                    "contents": {
                        "type": "bubble",
                        "header": {
                            "type": "box",
                            "layout": "vertical",
                            "contents": [
                                {"type": "text", "text": "üë∂ ‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î‡∏ö‡∏∏‡∏ï‡∏£", "weight": "bold", "size": "lg"}
                            ]
                        },
                        "body": {
                            "type": "box",
                            "layout": "vertical",
                            "contents": [
                                {"type": "text", "text": "‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤:", "weight": "bold"},
                                {"type": "text", "text": "‚Ä¢ ‡∏•‡∏≤‡πÑ‡∏î‡πâ 90 ‡∏ß‡∏±‡∏ô", "wrap": True},
                                {"type": "text", "text": "‚Ä¢ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏•‡∏≤", "wrap": True},
                                {"type": "text", "text": "‚Ä¢ ‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô/‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏•‡∏≠‡∏î‡πÑ‡∏î‡πâ", "wrap": True},
                                {"type": "separator", "margin": "md"},
                                {"type": "text", "text": "‡∏™‡∏≤‡∏°‡∏µ‡∏•‡∏≤‡∏ä‡πà‡∏ß‡∏¢‡∏†‡∏£‡∏£‡∏¢‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î:", "weight": "bold", "margin": "md"},
                                {"type": "text", "text": "‚Ä¢ ‡∏•‡∏≤‡πÑ‡∏î‡πâ 15 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£", "wrap": True}
                            ]
                        }
                    }
                }),
                "tags": ["‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î", "‡∏Ñ‡∏•‡∏≠‡∏î‡∏ö‡∏∏‡∏ï‡∏£", "maternity"]
            },
            {
                "name": "‡∏•‡∏≤‡∏≠‡∏∏‡∏õ‡∏™‡∏°‡∏ö‡∏ó",
                "description": "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏≠‡∏∏‡∏õ‡∏™‡∏°‡∏ö‡∏ó",
                "message_type": "text",
                "category_id": categories.get("‡∏Å‡∏≤‡∏£‡∏•‡∏≤"),
                "content": json.dumps({
                    "type": "text",
                    "text": "‚ò∏Ô∏è ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏≠‡∏∏‡∏õ‡∏™‡∏°‡∏ö‡∏ó:\n\n‚Ä¢ ‡∏•‡∏≤‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 120 ‡∏ß‡∏±‡∏ô\n‚Ä¢ ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏õ‡∏µ\n‚Ä¢ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏•‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 60 ‡∏ß‡∏±‡∏ô\n‚Ä¢ ‡∏¢‡∏∑‡πà‡∏ô‡πÉ‡∏ö‡∏•‡∏≤‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 60 ‡∏ß‡∏±‡∏ô"
                }),
                "tags": ["‡∏•‡∏≤‡∏ö‡∏ß‡∏ä", "‡∏≠‡∏∏‡∏õ‡∏™‡∏°‡∏ö‡∏ó", "‡∏ö‡∏ß‡∏ä"]
            },
            
            # ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£ (‡πÄ‡∏û‡∏¥‡πà‡∏° 3 ‡∏Ç‡πâ‡∏≠)
            {
                "name": "‡∏Ñ‡πà‡∏≤‡πÄ‡∏•‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏∏‡∏ï‡∏£",
                "description": "‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏•‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏∏‡∏ï‡∏£",
                "message_type": "text",
                "category_id": categories.get("‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£"),
                "content": json.dumps({
                    "type": "text",
                    "text": "üéì ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏•‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏∏‡∏ï‡∏£:\n\n‚Ä¢ ‡πÄ‡∏ö‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• - ‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ\n‚Ä¢ ‡∏ö‡∏∏‡∏ï‡∏£‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà 1-3 ‡πÄ‡∏ö‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô\n‚Ä¢ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê: ‡πÄ‡∏ö‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô\n‚Ä¢ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏≠‡∏Å‡∏ä‡∏ô: ‡πÄ‡∏ö‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡πÄ‡∏û‡∏î‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î\n\nüí° ‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏∑‡πà‡∏ô‡πÄ‡∏ö‡∏¥‡∏Å‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1 ‡∏õ‡∏µ‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ó‡∏≠‡∏°"
                }),
                "tags": ["‡∏Ñ‡πà‡∏≤‡πÄ‡∏•‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", "‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ö‡∏∏‡∏ï‡∏£", "education"]
            },
            {
                "name": "‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£",
                "description": "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£",
                "message_type": "text",
                "category_id": categories.get("‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£"),
                "content": json.dumps({
                    "type": "text",
                    "text": "üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£:\n\n‚Ä¢ ‡∏Å‡∏π‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô: ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡πÄ‡∏ó‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô\n‚Ä¢ ‡∏Å‡∏π‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤: ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡πÄ‡∏ó‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô\n‚Ä¢ ‡∏Å‡∏π‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢: ‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå ‡∏ò‡∏≠‡∏™.\n‚Ä¢ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢: ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î\n\nüìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠: ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£ ‡πÇ‡∏ó‡∏£.1234"
                }),
                "tags": ["‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ", "‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠", "loan"]
            },
            {
                "name": "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏•‡∏∏‡πà‡∏°",
                "description": "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏•‡∏∏‡πà‡∏°",
                "message_type": "text",
                "category_id": categories.get("‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£"),
                "content": json.dumps({
                    "type": "text",
                    "text": "üè• ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏•‡∏∏‡πà‡∏°:\n\n‚Ä¢ ‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÉ‡∏ô: 100,000 ‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ\n‚Ä¢ ‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ô‡∏≠‡∏Å: 30,000 ‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ\n‚Ä¢ ‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°: 5,000 ‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ\n‚Ä¢ ‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏: 200,000 ‡∏ö‡∏≤‡∏ó\n‚Ä¢ ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°: ‡∏ï‡∏ô‡πÄ‡∏≠‡∏á ‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏£‡∏™ ‡∏ö‡∏∏‡∏ï‡∏£\n\nüìÑ ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: www.moj-insurance.com"
                }),
                "tags": ["‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô", "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û", "insurance"]
            },
            
            # ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö (‡πÄ‡∏û‡∏¥‡πà‡∏° 2 ‡∏Ç‡πâ‡∏≠)
            {
                "name": "‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£",
                "description": "‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ",
                "message_type": "text",
                "category_id": categories.get("‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö"),
                "content": json.dumps({
                    "type": "text",
                    "text": "üìÖ ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ ‡∏õ‡∏µ 2568:\n\n‚Ä¢ ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏≥: ‡πÄ‡∏™‡∏≤‡∏£‡πå-‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå\n‚Ä¢ ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏±‡∏Å‡∏Ç‡∏±‡∏ï‡∏§‡∏Å‡∏©‡πå: 18 ‡∏ß‡∏±‡∏ô\n‚Ä¢ ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏î‡πÄ‡∏ä‡∏¢: ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®\n\nüîç ‡∏î‡∏π‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ‡∏Å‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏ô‡∏π '‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î'"
                }),
                "tags": ["‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î", "‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô", "holiday"]
            },
            {
                "name": "‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£",
                "description": "‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢",
                "message_type": "text",
                "category_id": categories.get("‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö"),
                "content": json.dumps({
                    "type": "text",
                    "text": "üëî ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢:\n\n‚Ä¢ ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå-‡∏û‡∏§‡∏´‡∏±‡∏™: ‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£/‡∏ä‡∏∏‡∏î‡∏™‡∏∏‡∏†‡∏≤‡∏û\n‚Ä¢ ‡∏®‡∏∏‡∏Å‡∏£‡πå: ‡∏ä‡∏∏‡∏î‡∏ú‡πâ‡∏≤‡πÑ‡∏ó‡∏¢/‡∏ú‡πâ‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á\n‚Ä¢ ‡∏á‡∏≤‡∏ô‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£: ‡∏ä‡∏∏‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ç‡∏≤‡∏ß/‡∏ä‡∏∏‡∏î‡∏Å‡∏≤‡∏Å‡∏µ\n\n‚ö†Ô∏è ‡∏´‡πâ‡∏≤‡∏°: ‡∏Å‡∏≤‡∏á‡πÄ‡∏Å‡∏á‡∏¢‡∏µ‡∏ô‡∏™‡πå, ‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡πÅ‡∏ï‡∏∞, ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∑‡∏î\n\nüìå ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏ô‡∏≤‡∏¢‡∏Å‡∏Ø ‡∏ß‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢"
                }),
                "tags": ["‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢", "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏ö‡∏ö", "dress code"]
            },
            
            # ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡πÄ‡∏û‡∏¥‡πà‡∏° 2 ‡∏Ç‡πâ‡∏≠)
            {
                "name": "‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°",
                "description": "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° HR",
                "message_type": "text_with_uri",
                "category_id": categories.get("‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ"),
                "content": json.dumps({
                    "type": "text",
                    "text": "üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° HR:\n\n‡∏Ñ‡∏•‡∏¥‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î:\n\nüìÑ ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏≤: https://hr.moj.go.th/forms/leave\nüìÑ ‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£: https://hr.moj.go.th/forms/welfare\nüìÑ ‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô: https://hr.moj.go.th/forms/evaluation"
                }),
                "tags": ["‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°", "‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î", "download", "forms"]
            },
            {
                "name": "‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡∏±‡∏ô‡∏•‡∏≤",
                "description": "‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠",
                "message_type": "text_with_quickreply",
                "category_id": categories.get("‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ"),
                "content": json.dumps({
                    "type": "text",
                    "text": "üîç ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠:\n\n1. ‡∏ú‡πà‡∏≤‡∏ô LINE: ‡∏û‡∏¥‡∏°‡∏û‡πå '‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡∏±‡∏ô‡∏•‡∏≤' ‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô\n   ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡∏±‡∏ô‡∏•‡∏≤ MOJ001\n\n2. ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå: https://hr.moj.go.th\n   Login ‡∏î‡πâ‡∏ß‡∏¢ Username/Password\n\n3. ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ HR ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á: ‡πÇ‡∏ó‡∏£.1234",
                    "quickReply": {
                        "items": [
                            {"action": {"type": "message", "label": "‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡∏±‡∏ô‡∏•‡∏≤", "text": "‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡∏±‡∏ô‡∏•‡∏≤ MOJ001"}},
                            {"action": {"type": "uri", "label": "‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå", "uri": "https://hr.moj.go.th"}},
                            {"action": {"type": "message", "label": "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ HR", "text": "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ HR"}}
                        ]
                    }
                }),
                "tags": ["‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡∏±‡∏ô‡∏•‡∏≤", "‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠", "check leave"]
            }
        ]
        
        # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° templates
        added_count = 0
        for template_data in new_templates:
            # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ template ‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            existing = db.query(MessageTemplate).filter(
                MessageTemplate.name == template_data["name"]
            ).first()
            
            if not existing and template_data["category_id"]:
                new_template = MessageTemplate(
                    name=template_data["name"],
                    description=template_data["description"],
                    message_type=template_data["message_type"],
                    category_id=template_data["category_id"],
                    content=template_data["content"],
                    is_active=True,
                    tags=template_data.get("tags", []),
                    created_at=datetime.now()
                )
                db.add(new_template)
                added_count += 1
                print(f"‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°: {template_data['name']}")
            else:
                print(f"‚ö†Ô∏è ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß: {template_data['name']}")
        
        db.commit()
        print(f"\n‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° Templates ‡πÉ‡∏´‡∏°‡πà: {added_count} templates")
        
        return added_count
    except Exception as e:
        print(f"‚ùå Error: {e}")
        db.rollback()
        return 0
    finally:
        db.close()

def main():
    print("üìù Phase 1.4: ‡πÄ‡∏û‡∏¥‡πà‡∏° Templates ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 20 ‡∏Ç‡πâ‡∏≠")
    print("="*60)
    
    # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö templates ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
    current_count, existing = check_current_templates()
    
    if current_count >= 20:
        print(f"\n‚úÖ ‡∏°‡∏µ Templates ‡∏Ñ‡∏£‡∏ö 20 ‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß ({current_count} templates)")
        print("üí° ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°")
    else:
        print(f"\n‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å {20 - current_count} templates")
        print("\nüîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° Templates ‡πÉ‡∏´‡∏°‡πà...")
        
        # ‡πÄ‡∏û‡∏¥‡πà‡∏° templates ‡πÉ‡∏´‡∏°‡πà
        added = add_new_hr_templates()
        
        # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
        new_count, _ = check_current_templates()
        print(f"\nüìä ‡∏™‡∏£‡∏∏‡∏õ: ‡∏°‡∏µ Templates ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î {new_count} templates")
        
        if new_count >= 20:
            print("‚úÖ Phase 1.4 ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå!")
        else:
            print(f"‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡∏Ç‡∏≤‡∏î‡∏≠‡∏µ‡∏Å {20 - new_count} templates")

if __name__ == "__main__":
    main()
